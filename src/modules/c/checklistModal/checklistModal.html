<template>
    <div class="modal-backdrop" onclick={handleCancel} tabindex="-1"></div>
    <section
        class="modal"
        role="dialog"
        aria-modal="true"
        aria-labelledby="modalTitle"
    >
        <form class="modal__form" onsubmit={handleSave} novalidate>
            <header class="modal__header">
                <h2 id="modalTitle" class="modal__title">New Checklist</h2>
                <button
                    type="button"
                    class="modal__close"
                    onclick={handleCancel}
                    title="Close"
                >
                    <span aria-hidden="true">&times;</span>
                </button>
            </header>
            <div class="modal__body">
                <!-- Loading indicator -->
                <template if:true={isLoading}>
                    <div class="loading-container">
                        <div class="spinner"></div>
                        <p>Loading form data...</p>
                    </div>
                </template>

                <!-- Error message -->
                <template if:true={error}>
                    <div class="error-message">
                        <p>{error}</p>
                    </div>
                </template>

                <div class="form-grid">
                    <!-- Checklist Name -->
                    <div class={checklistNameClass}>
                        <label for="checklistName"
                            >Checklist Name<span class="required"
                                >*</span
                            ></label
                        >
                        <input
                            type="text"
                            id="checklistName"
                            name="checklistName"
                            placeholder="Enter checklist name"
                            value={form.checklistName}
                            oninput={handleInputChange}
                            aria-invalid={isChecklistNameInvalid}
                        />
                        <template if:true={errors.checklistName}>
                            <span class="error-text"
                                >{errors.checklistName}</span
                            >
                        </template>
                    </div>
                    <!-- Status -->
                    <div class={statusClass}>
                        <label for="status"
                            >Status<span class="required">*</span></label
                        >
                        <select
                            id="status"
                            name="status"
                            value={form.status}
                            onchange={handleInputChange}
                            aria-invalid={isStatusInvalid}
                        >
                            <template
                                for:each={statusOptions}
                                for:item="option"
                            >
                                <option key={option.value} value={option.value}>
                                    {option.label}
                                </option>
                            </template>
                        </select>
                        <template if:true={errors.status}>
                            <span class="error-text">{errors.status}</span>
                        </template>
                    </div>
                    <!-- Created For -->
                    <div class={createdForClass}>
                        <label for="createdFor"
                            >Created For<span class="required">*</span></label
                        >
                        <select
                            id="createdFor"
                            name="createdFor"
                            value={form.createdFor}
                            onchange={handleInputChange}
                            aria-invalid={isCreatedForInvalid}
                        >
                            <option value="">--Select a User--</option>
                            <template for:each={userOptions} for:item="option">
                                <option key={option.value} value={option.value}>
                                    {option.label}
                                </option>
                            </template>
                        </select>
                        <template if:true={errors.createdFor}>
                            <span class="error-text">{errors.createdFor}</span>
                        </template>
                    </div>
                    <!-- Checklist Category -->
                    <div class={checklistCategoryClass}>
                        <label for="checklistCategory">
                            Checklist Category<span class="required">*</span>
                            <span
                                class="icon info-icon"
                                tabindex="0"
                                aria-label="Category info"
                            ></span>
                        </label>
                        <select
                            id="checklistCategory"
                            name="checklistCategory"
                            value={form.checklistCategory}
                            onchange={handleInputChange}
                            aria-invalid={isChecklistCategoryInvalid}
                        >
                            <option value="">--None--</option>
                            <template
                                for:each={categoryOptions}
                                for:item="option"
                            >
                                <option key={option.value} value={option.value}>
                                    {option.label}
                                </option>
                            </template>
                        </select>
                        <template if:true={errors.checklistCategory}>
                            <span class="error-text"
                                >{errors.checklistCategory}</span
                            >
                        </template>
                    </div>
                    <!-- Assessment Type -->
                    <div class={assessmentTypeClass}>
                        <label for="assessmentType"
                            >Assessment Type<span class="required"
                                >*</span
                            ></label
                        >
                        <select
                            id="assessmentType"
                            name="assessmentType"
                            value={form.assessmentType}
                            onchange={handleInputChange}
                            aria-invalid={isAssessmentTypeInvalid}
                        >
                            <option value="">--Select Assessment Type--</option>
                            <template
                                for:each={assessmentTypeOptions}
                                for:item="option"
                            >
                                <option key={option.value} value={option.value}>
                                    {option.label}
                                </option>
                            </template>
                        </select>
                        <template if:true={errors.assessmentType}>
                            <span class="error-text"
                                >{errors.assessmentType}</span
                            >
                        </template>
                    </div>
                    <!-- Description -->
                    <div class="form-group">
                        <label for="description">
                            Description
                            <span
                                class="icon info-icon"
                                tabindex="0"
                                aria-label="Description info"
                            ></span>
                        </label>
                        <textarea
                            id="description"
                            name="description"
                            placeholder="Write a few sentences about the checklist..."
                            value={form.description}
                            oninput={handleInputChange}
                        ></textarea>
                    </div>
                </div>
            </div>
            <footer class="modal__footer">
                <button type="button" class="btn ghost" onclick={handleCancel}>
                    Cancel
                </button>
                <button
                    type="button"
                    class="btn secondary"
                    onclick={handleSaveAndNew}
                >
                    Save &amp; New
                </button>
                <button type="submit" class="btn primary">Save</button>
            </footer>
        </form>
    </section>
</template>
